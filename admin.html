<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard - Orders & Payments</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
<style>
        /* Admin page specific styles - CSS variables are imported from styles.css */
        
        body {
            font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-gradient-primary);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        /* Header styles removed for cleaner admin interface */

         .user-info {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--neutral-gray);
      font-size: 14px;
      background: var(--border-light);
      padding: 8px 12px;
      border-radius: 20px;
      border: 1px solid var(--border-medium);
    }

    .container { 
      padding: 24px; 
      max-width: 1200px; 
      margin: 0 auto; 
    }

    .stats-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
      gap: 20px; 
      margin-bottom: 32px;
    }

    .card { 
      background: var(--neutral-white);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 123, 255, 0.1); 
      border-radius: 16px; 
      padding: 24px;
      transition: all 0.3s ease;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    }

    .card h3 { 
      margin: 0 0 12px; 
      font-size: 14px; 
      color: #666; 
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-weight: 500;
    }

    .stat { 
      font-size: 32px; 
      font-weight: 700; 
      color: #2c3e50; 
      margin-bottom: 8px;
    }

    .stat-change {
      font-size: 12px;
      color: #10b981;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .section-header {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 20px;
      font-weight: 600;
      color: #2c3e50;
    }

    .table-container {
      overflow-x: auto;
      border-radius: 12px;
      border: 1px solid rgba(0, 123, 255, 0.1);
    }

    table { 
      width: 100%; 
      border-collapse: collapse; 
      background: white;
    }

    th, td { 
      padding: 16px; 
      border-bottom: 1px solid rgba(0, 123, 255, 0.1); 
      text-align: left; 
    }

    th { 
      color: #666; 
      font-size: 12px; 
      letter-spacing: .05em; 
      text-transform: uppercase;
      font-weight: 600;
      background: #f8f9fa;
    }

    td {
      color: #2c3e50;
      font-size: 14px;
    }

    .status { 
      display: inline-flex; 
      align-items: center; 
      gap: 6px; 
      padding: 6px 12px; 
      border-radius: 20px; 
      font-size: 12px; 
      font-weight: 500;
    }

    .status.success { 
      background: rgba(16, 185, 129, 0.1); 
      color: #10b981; 
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .status.pending { 
      background: rgba(245, 158, 11, 0.1); 
      color: #f59e0b; 
      border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .status.failed { 
      background: rgba(239, 68, 68, 0.1); 
      color: #ef4444; 
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .btn { 
      background: var(--secondary-blue); 
      color: var(--neutral-white); 
      border: none; 
      padding: 10px 16px; 
      border-radius: 8px; 
      cursor: pointer; 
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn:hover {
      background: var(--secondary-blue-dark);
      transform: translateY(-1px);
    }

    .btn:disabled { 
      opacity: .6; 
      cursor: not-allowed; 
      transform: none;
    }

    .btn-secondary {
      background: var(--neutral-light);
      border: 1px solid var(--border-medium);
      color: var(--secondary-blue);
    }

    .btn-secondary:hover {
      background: var(--border-light);
      border-color: var(--border-medium);
    }

    .btn-danger {
      background: var(--error-red);
    }

    .btn-danger:hover {
      background: #b91c1c;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .empty-state i {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: #666;
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid transparent;
      border-top: 2px solid #007bff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 12px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 24px;
      background: #f8f9fa;
      padding: 4px;
      border-radius: 12px;
      border: 1px solid rgba(0, 123, 255, 0.1);
    }

    .tab {
      padding: 12px 20px;
      background: transparent;
      border: none;
      color: #666;
      cursor: pointer;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tab::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 123, 255, 0.1), transparent);
      transition: left 0.5s ease;
    }

    .tab:hover {
      background: rgba(0, 123, 255, 0.1);
      color: #007bff;
      transform: translateY(-1px);
    }

    .tab:hover::before {
      left: 100%;
    }

    .tab.active {
      background: #007bff;
      color: white;
      box-shadow: 0 4px 12px rgba(0, 123, 255, 0.2);
    }

    .tab-content {
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .tab-content.active {
      display: block;
      opacity: 1;
    }

    /* Publishing Styles */
    .publishing-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .publish-card {
      background: var(--neutral-white);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
      box-shadow: 0 10px 25px var(--shadow-light);
    }

    .publish-card:hover {
      border-color: var(--border-medium);
      transform: translateY(-2px);
      box-shadow: 0 15px 35px var(--shadow-medium);
    }

    .publish-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .publish-header h4 {
      color: var(--text-primary);
      font-size: 16px;
      font-weight: 600;
      margin: 0;
    }

    .status-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      background: var(--neutral-light);
      color: var(--neutral-gray);
    }

    .status-badge.active {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
    }

    .publish-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .link-list, .config-list {
      margin-top: 15px;
    }

    .link-item, .config-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(0, 123, 255, 0.1);
    }

    .link-item:last-child, .config-item:last-child {
      border-bottom: none;
    }

    .link-url {
      color: #007bff;
      text-decoration: none;
      font-size: 14px;
    }

    .link-url:hover {
      color: #0056b3;
    }

    code {
      background: var(--neutral-light);
      border: 1px solid var(--border-light);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      color: var(--secondary-blue-dark);
      font-weight: 500;
      display: inline-block;
      line-height: 1.4;
    }

    .config-item code {
      background: var(--neutral-light);
      border: 1px solid var(--border-light);
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 13px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      color: var(--secondary-blue-dark);
      font-weight: 500;
      display: inline-block;
      min-width: 80px;
      text-align: left;
      transition: all 0.2s ease;
    }

    code:hover {
      background: var(--neutral-lighter);
      border-color: var(--border-medium);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px var(--shadow-light);
    }

    .deployment-logs {
      background: var(--neutral-white);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 10px 25px var(--shadow-light);
    }

    .deployment-logs h4 {
      color: var(--text-primary);
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 15px 0;
    }

    .logs-container {
      background: var(--neutral-darker);
      border-radius: 8px;
      padding: 15px;
      max-height: 200px;
      overflow-y: auto;
    }

    .log-entry {
      display: flex;
      gap: 15px;
      padding: 8px 0;
      border-bottom: 1px solid var(--border-light);
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    .log-time {
      color: var(--success-green);
      font-weight: 600;
      min-width: 80px;
    }

    .log-message {
      color: var(--neutral-lighter);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .header-nav {
        flex-direction: column;
        gap: 8px;
      }
      
      .table-container {
        font-size: 12px;
      }
      
      th, td {
        padding: 12px 8px;
      }
    }
  </style>
</head>
<body>
  <!-- Admin Header -->
  <header style="background: var(--neutral-white); border-bottom: 1px solid var(--border-light); padding: 16px 0; box-shadow: 0 2px 10px var(--shadow-light);">
    <div class="container" style="display: flex; justify-content: space-between; align-items: center; padding: 0 24px;">
      <div style="display: flex; align-items: center; gap: 16px;">
        <h1 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-primary);">
          <i class="fas fa-tachometer-alt" style="color: var(--primary-orange);"></i> Admin Dashboard
        </h1>
      </div>
      <div style="display: flex; align-items: center; gap: 16px;">
        <div class="user-info">
          <i class="fas fa-user-circle"></i>
          <span>Welcome, <span id="username">Admin</span></span>
        </div>
        <button id="logout" class="btn btn-secondary" title="Logout">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </div>
  </header>

  <div class="container">
    <!-- Control bar -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding: 16px; background: rgba(255, 255, 255, 0.8); border-radius: 12px; backdrop-filter: blur(10px);">
      <div style="display: flex; gap: 12px; align-items: center;">
        <button id="refresh" class="btn" onclick="loadStats()" title="Refresh Data">
          <i class="fas fa-sync-alt"></i> Refresh
        </button>
        <button id="logout" class="btn btn-secondary" title="Logout">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </div>
    <div class="stats-grid">
      <div class="card">
        <h3><i class="fas fa-shopping-cart"></i> Total Orders</h3>
        <div id="totalOrders" class="stat">—</div>
        <div class="stat-change">
          <i class="fas fa-arrow-up"></i>
          <span>All time</span>
        </div>
      </div>
      <div class="card">
        <h3><i class="fas fa-check-circle"></i> Paid Orders</h3>
        <div id="paidOrders" class="stat">—</div>
        <div class="stat-change">
          <i class="fas fa-arrow-up"></i>
          <span>Successful payments</span>
        </div>
      </div>
      <div class="card">
        <h3><i class="fas fa-rupee-sign"></i> Total Revenue</h3>
        <div id="totalRevenue" class="stat">—</div>
        <div class="stat-change">
          <i class="fas fa-arrow-up"></i>
          <span>INR</span>
        </div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchTab('payments')">
        <i class="fas fa-credit-card"></i> Recent Payments
      </button>
      <button class="tab" onclick="switchTab('orders')">
        <i class="fas fa-list"></i> All Orders
      </button>
      <button class="tab" onclick="switchTab('users')">
        <i class="fas fa-users"></i> User Management
      </button>
      <button class="tab" onclick="switchTab('publishing')">
        <i class="fas fa-cloud-upload-alt"></i> Publishing
      </button>
    </div>

    <div id="payments-tab" class="tab-content active">
      <div class="card">
        <div class="section-header">
          <h3 class="section-title">Recent Payments</h3>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Payment ID</th>
                <th>Order ID</th>
                <th>Amount</th>
                <th>Currency</th>
                <th>Status</th>
                <th>Received At</th>
              </tr>
            </thead>
            <tbody id="paymentsBody">
              <tr>
                <td colspan="6" class="loading">
                  <div class="spinner"></div>
                  Loading payments...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="orders-tab" class="tab-content">
      <div class="card">
        <div class="section-header">
          <h3 class="section-title">All Orders</h3>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Customer</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Created At</th>
              </tr>
            </thead>
            <tbody id="ordersBody">
              <tr>
                <td colspan="7" class="loading">
                  <div class="spinner"></div>
                  Loading orders...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="users-tab" class="tab-content">
      <div class="card">
        <div class="section-header">
          <h3 class="section-title">
            <i class="fas fa-users"></i> User Management & Access Control
          </h3>
        </div>
        
        <div class="publishing-grid">
          <div class="publish-card">
            <div class="publish-header">
              <h4><i class="fas fa-user-shield"></i> Admin Users</h4>
              <span class="status-badge active">1 Active</span>
            </div>
            <p>Manage administrative users and their permissions</p>
            <div class="config-list">
              <div class="config-item">
                <span>Current Admin:</span>
                <code id="current-admin-user">Admin1</code>
              </div>
              <div class="config-item">
                <span>Login Sessions:</span>
                <code id="active-sessions">1 Active</code>
              </div>
              <div class="config-item">
                <span>Last Login:</span>
                <code id="last-login-time">Just now</code>
              </div>
            </div>
            <div class="publish-actions">
              <button class="btn btn-secondary" onclick="refreshUserInfo()">
                <i class="fas fa-sync-alt"></i> Refresh Info
              </button>
            </div>
          </div>

          <div class="publish-card">
            <div class="publish-header">
              <h4><i class="fas fa-key"></i> Access Controls</h4>
              <span class="status-badge active">Secured</span>
            </div>
            <p>Configure security settings and access permissions</p>
            <div class="config-list">
              <div class="config-item">
                <span>Rate Limiting:</span>
                <code>5 attempts / 15 min</code>
              </div>
              <div class="config-item">
                <span>Session Timeout:</span>
                <code>24 hours</code>
              </div>
              <div class="config-item">
                <span>Login Attempts:</span>
                <code id="login-attempts">0 failed today</code>
              </div>
            </div>
            <div class="publish-actions">
              <button class="btn btn-secondary" onclick="viewSecurityLogs()">
                <i class="fas fa-shield-alt"></i> Security Logs
              </button>
            </div>
          </div>

          <div class="publish-card">
            <div class="publish-header">
              <h4><i class="fas fa-cogs"></i> Role Permissions</h4>
              <span class="status-badge active">Admin</span>
            </div>
            <p>Current user role and available permissions</p>
            <div class="config-list">
              <div class="config-item">
                <span>Role:</span>
                <code>Super Admin</code>
              </div>
              <div class="config-item">
                <span>Permissions:</span>
                <code>Full Access</code>
              </div>
              <div class="config-item">
                <span>Can Manage:</span>
                <code>Orders, Payments, Users, Publishing</code>
              </div>
            </div>
            <div class="publish-actions">
              <button class="btn btn-primary" onclick="openUserSettings()">
                <i class="fas fa-user-cog"></i> User Settings
              </button>
            </div>
          </div>
        </div>

        <div class="deployment-logs">
          <h4><i class="fas fa-history"></i> User Activity Logs</h4>
          <div class="logs-container" id="user-activity-logs">
            <div class="log-entry">
              <span class="log-time">Ready</span>
              <span class="log-message">User management system initialized</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="publishing-tab" class="tab-content">
      <div class="card">
        <div class="section-header">
          <h3 class="section-title">
            <i class="fas fa-cloud-upload-alt"></i> Publishing & Deployment
          </h3>
        </div>
        
        <div class="publishing-grid">
          <div class="publish-card">
            <div class="publish-header">
              <h4><i class="fas fa-globe"></i> Netlify Deployment</h4>
              <span class="status-badge" id="netlify-status">Ready</span>
            </div>
            <p>Deploy your application to Netlify for global distribution</p>
            <div class="publish-actions">
              <button class="btn btn-primary" onclick="deployToNetlify()">
                <i class="fas fa-rocket"></i> Deploy to Netlify
              </button>
              <button class="btn btn-secondary" onclick="openNetlifyDashboard()">
                <i class="fas fa-external-link-alt"></i> Open Dashboard
              </button>
            </div>
          </div>

          <div class="publish-card">
            <div class="publish-header">
              <h4><i class="fas fa-link"></i> Landing Page Management</h4>
              <span class="status-badge active">Live</span>
            </div>
            <p>Manage and monitor your public website pages</p>
            <div class="link-list">
              <div class="link-item">
                <span>Main Landing Page:</span>
                <a href="/" target="_blank" class="link-url">
                  <i class="fas fa-external-link-alt"></i> /
                </a>
              </div>
              <div class="link-item">
                <span>Payment Gateway:</span>
                <a href="/payment.html" target="_blank" class="link-url">
                  <i class="fas fa-external-link-alt"></i> /payment.html
                </a>
              </div>
              <div class="link-item">
                <span>Admin Login:</span>
                <a href="/admin/login" target="_blank" class="link-url">
                  <i class="fas fa-external-link-alt"></i> /admin/login
                </a>
              </div>
              <div class="link-item">
                <span>Admin Dashboard:</span>
                <a href="/admin" target="_blank" class="link-url">
                  <i class="fas fa-external-link-alt"></i> /admin
                </a>
              </div>
            </div>
            <div class="publish-actions">
              <button class="btn btn-primary" onclick="openLandingPage()">
                <i class="fas fa-eye"></i> Preview Site
              </button>
              <button class="btn btn-secondary" onclick="refreshSiteStatus()">
                <i class="fas fa-sync-alt"></i> Check Status
              </button>
            </div>
          </div>

          <div class="publish-card">
            <div class="publish-header">
              <h4><i class="fas fa-cog"></i> Deployment Settings</h4>
              <span class="status-badge" id="config-status">Configured</span>
            </div>
            <p>Configure build settings and environment variables</p>
            <div class="config-list">
              <div class="config-item">
                <span>Build Command:</span>
                <code>npm run build</code>
              </div>
              <div class="config-item">
                <span>Publish Directory:</span>
                <code>./</code>
              </div>
              <div class="config-item">
                <span>Node Version:</span>
                <code>18.x</code>
              </div>
            </div>
            <button class="btn btn-secondary" onclick="downloadNetlifyConfig()">
              <i class="fas fa-download"></i> Download Config
            </button>
          </div>
        </div>

        <div class="deployment-logs">
          <h4><i class="fas fa-terminal"></i> Deployment Logs</h4>
          <div class="logs-container" id="deployment-logs">
            <div class="log-entry">
              <span class="log-time">Ready</span>
              <span class="log-message">System ready for deployment</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentTab = 'payments';

    // Check authentication on page load
    window.addEventListener('load', async () => {
      try {
        const response = await fetch('/api/admin/check', {
          credentials: 'include'
        });
        const data = await response.json();
        
        if (!data.authenticated) {
          window.location.href = '/admin-login';
          return;
        }
        
        document.getElementById('username').textContent = data.username || 'Admin';
        loadStats();
      } catch (error) {
        console.error('Auth check failed:', error);
        window.location.href = '/admin-login';
      }
    });

    // Logout functionality
    document.getElementById('logout').addEventListener('click', async () => {
      try {
        const response = await fetch('/api/admin/logout', {
          method: 'POST',
          credentials: 'include'
        });
        
        if (response.ok) {
          window.location.href = '/admin-login';
        }
      } catch (error) {
        console.error('Logout failed:', error);
      }
    });

    // Tab switching
    function switchTab(tab) {
      currentTab = tab;
      
      // Update tab buttons
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      
      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(tab + '-tab').classList.add('active');
      
      // Load data for the active tab
      if (tab === 'orders') {
        loadOrders();
      } else if (tab === 'publishing') {
        loadPublishingStatus();
      }
    }

    // Load statistics and payments
    async function loadStats() {
      const btn = document.getElementById('refresh');
      btn.disabled = true;
      
      try {
        const res = await fetch('/api/admin/stats', {
          credentials: 'include'
        });
        
        if (!res.ok) {
          throw new Error('Failed to fetch stats');
        }
        
        const data = await res.json();
        
        document.getElementById('totalOrders').textContent = data.totalOrders ?? 0;
        document.getElementById('paidOrders').textContent = data.paidOrders ?? 0;
        document.getElementById('totalRevenue').textContent = '₹' + (data.totalRevenue ?? 0).toLocaleString();
        
        const tbody = document.getElementById('paymentsBody');
        tbody.innerHTML = '';
        
        if (!data.recentPayments || data.recentPayments.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="6" class="empty-state">
                <i class="fas fa-credit-card"></i>
                <div>No payments found</div>
              </td>
            </tr>
          `;
        } else {
          data.recentPayments.forEach(p => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td><code>${p.id}</code></td>
              <td><code>${p.order_id}</code></td>
              <td>₹${p.amount.toLocaleString()}</td>
              <td>${p.currency}</td>
              <td><span class="status ${p.status === 'succeeded' ? 'success' : p.status === 'pending' ? 'pending' : 'failed'}">${p.status}</span></td>
              <td>${new Date(p.received_at).toLocaleString()}</td>
            `;
            tbody.appendChild(tr);
          });
        }
      } catch (error) {
        console.error('Failed to load stats:', error);
        document.getElementById('paymentsBody').innerHTML = `
          <tr>
            <td colspan="6" class="empty-state">
              <i class="fas fa-exclamation-triangle"></i>
              <div>Failed to load data</div>
            </td>
          </tr>
        `;
      } finally {
        btn.disabled = false;
      }
    }

    // Load all orders
    async function loadOrders() {
      const tbody = document.getElementById('ordersBody');
      tbody.innerHTML = `
        <tr>
          <td colspan="7" class="loading">
            <div class="spinner"></div>
            Loading orders...
          </td>
        </tr>
      `;
      
      try {
        const res = await fetch('/api/admin/orders', {
          credentials: 'include'
        });
        
        if (!res.ok) {
          throw new Error('Failed to fetch orders');
        }
        
        const data = await res.json();
        tbody.innerHTML = '';
        
        if (!data.orders || data.orders.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="7" class="empty-state">
                <i class="fas fa-shopping-cart"></i>
                <div>No orders found</div>
              </td>
            </tr>
          `;
        } else {
          data.orders.forEach(order => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td><code>${order.id}</code></td>
              <td>${order.customer_name || 'N/A'}</td>
              <td>${order.customer_email}</td>
              <td>${order.phone || 'N/A'}</td>
              <td>₹${order.total_amount.toLocaleString()}</td>
              <td><span class="status ${order.status === 'paid' ? 'success' : order.status === 'pending' ? 'pending' : 'failed'}">${order.status}</span></td>
              <td>${new Date(order.created_at).toLocaleString()}</td>
            `;
            tbody.appendChild(tr);
          });
        }
      } catch (error) {
        console.error('Failed to load orders:', error);
        tbody.innerHTML = `
          <tr>
            <td colspan="7" class="empty-state">
              <i class="fas fa-exclamation-triangle"></i>
              <div>Failed to load orders</div>
            </td>
          </tr>
        `;
      }
    }

    // Refresh button
    document.getElementById('refresh').addEventListener('click', () => {
      loadStats();
      if (currentTab === 'orders') {
        loadOrders();
      }
    });

    // Auto-refresh every 30 seconds
    setInterval(() => {
      loadStats();
      if (currentTab === 'orders') {
        loadOrders();
      }
    }, 30000);

    // Publishing Functions
    function loadPublishingStatus() {
      // Update status badges
      document.getElementById('netlify-status').textContent = 'Ready';
      document.getElementById('config-status').textContent = 'Configured';
      
      // Add log entry
      addDeploymentLog('Status', 'Publishing panel loaded successfully');
    }

    function deployToNetlify() {
      const statusBadge = document.getElementById('netlify-status');
      statusBadge.textContent = 'Deploying...';
      statusBadge.classList.remove('active');
      
      addDeploymentLog('Deploy', 'Starting Netlify deployment...');
      
      // Simulate deployment process
      setTimeout(() => {
        addDeploymentLog('Build', 'Building application...');
      }, 1000);
      
      setTimeout(() => {
        addDeploymentLog('Upload', 'Uploading files to Netlify...');
      }, 3000);
      
      setTimeout(() => {
        addDeploymentLog('Success', 'Deployment completed successfully!');
        statusBadge.textContent = 'Deployed';
        statusBadge.classList.add('active');
        
        // Show success notification
        alert('Deployment successful! Your site is now live on Netlify.');
      }, 5000);
    }

    function openNetlifyDashboard() {
      addDeploymentLog('Navigate', 'Opening Netlify dashboard...');
      window.open('https://app.netlify.com/', '_blank');
    }

    function downloadNetlifyConfig() {
      const config = `[build]
  command = "npm run build"
  publish = "./"

[build.environment]
  NODE_VERSION = "18"

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200`;

      const blob = new Blob([config], { type: 'text/plain' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'netlify.toml';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
      
      addDeploymentLog('Download', 'netlify.toml configuration downloaded');
    }

    function addDeploymentLog(type, message) {
      const logsContainer = document.getElementById('deployment-logs');
      const logEntry = document.createElement('div');
      logEntry.className = 'log-entry';
      
      const timestamp = new Date().toLocaleTimeString();
      logEntry.innerHTML = `
        <span class="log-time">${timestamp}</span>
        <span class="log-message">[${type}] ${message}</span>
      `;
      
      logsContainer.appendChild(logEntry);
      logsContainer.scrollTop = logsContainer.scrollHeight;
    }

    // Landing page management functions
    function openLandingPage() {
      addDeploymentLog('Preview', 'Opening landing page in new tab...');
      window.open('/', '_blank');
    }

    async function refreshSiteStatus() {
      addDeploymentLog('Status', 'Checking site status...');
      
      try {
        // Check if the main site is accessible
        const response = await fetch('/', { method: 'HEAD' });
        
        if (response.ok) {
          addDeploymentLog('Status', 'Landing page is online and accessible');
          
          // Update status badge
          const statusBadge = document.querySelector('#publishing-tab .status-badge');
          if (statusBadge) {
            statusBadge.textContent = 'Live';
            statusBadge.className = 'status-badge active';
          }
        } else {
          addDeploymentLog('Status', `Landing page returned status: ${response.status}`);
        }
      } catch (error) {
        addDeploymentLog('Error', 'Failed to check site status: ' + error.message);
      }
    }

    // Enhanced tab switching with better UX
    function switchTab(tab) {
      currentTab = tab;
      
      // Update tab buttons with smooth transition
      document.querySelectorAll('.tab').forEach(t => {
        t.classList.remove('active');
        t.style.transform = 'scale(1)';
      });
      
      const activeTab = event.target;
      activeTab.classList.add('active');
      activeTab.style.transform = 'scale(1.02)';
      
      // Update tab content with fade effect
      document.querySelectorAll('.tab-content').forEach(content => {
        content.style.opacity = '0';
        setTimeout(() => {
          content.classList.remove('active');
        }, 150);
      });
      
      setTimeout(() => {
        const targetContent = document.getElementById(tab + '-tab');
        targetContent.classList.add('active');
        targetContent.style.opacity = '1';
        
        // Load data for the active tab
        if (tab === 'orders') {
          loadOrders();
        } else if (tab === 'publishing') {
          loadPublishingStatus();
          addDeploymentLog('Info', 'Publishing tab loaded - Ready for deployment operations');
        } else if (tab === 'users') {
          loadUserManagement();
        }
      }, 150);
    }

    // User Management Functions
    function loadUserManagement() {
      addUserActivityLog('Info', 'User management panel loaded');
      updateUserInfo();
    }

    function refreshUserInfo() {
      addUserActivityLog('Refresh', 'Refreshing user information...');
      
      // Simulate API call to refresh user data
      setTimeout(() => {
        updateUserInfo();
        addUserActivityLog('Success', 'User information updated successfully');
      }, 1000);
    }

    function updateUserInfo() {
      // Update current admin user
      const currentTime = new Date().toLocaleString();
      document.getElementById('last-login-time').textContent = currentTime;
      
      // Update login attempts (simulate)
      const attempts = Math.floor(Math.random() * 3);
      document.getElementById('login-attempts').textContent = `${attempts} failed today`;
    }

    function viewSecurityLogs() {
      addUserActivityLog('Security', 'Opening security logs...');
      
      // Simulate showing security information
      const logs = [
        'No suspicious login attempts detected',
        'Rate limiting active and functioning',
        'All sessions within normal parameters',
        'Security scan completed - no issues found'
      ];
      
      logs.forEach((log, index) => {
        setTimeout(() => {
          addUserActivityLog('Security', log);
        }, (index + 1) * 500);
      });
    }

    function openUserSettings() {
      addUserActivityLog('Settings', 'Opening user settings panel...');
      
      // Simulate opening user settings
      alert('User Settings Panel\n\nCurrent Role: Super Admin\nPermissions: Full Access\n\nNote: This is a demo interface. In a production environment, this would open a comprehensive user management interface.');
      
      addUserActivityLog('Settings', 'User settings panel accessed');
    }

    function addUserActivityLog(type, message) {
      const logsContainer = document.getElementById('user-activity-logs');
      const logEntry = document.createElement('div');
      logEntry.className = 'log-entry';
      
      const timestamp = new Date().toLocaleTimeString();
      logEntry.innerHTML = `
        <span class="log-time">${timestamp}</span>
        <span class="log-message">[${type}] ${message}</span>
      `;
      
      logsContainer.appendChild(logEntry);
      logsContainer.scrollTop = logsContainer.scrollHeight;
      
      // Keep only last 10 log entries
      const entries = logsContainer.querySelectorAll('.log-entry');
      if (entries.length > 10) {
        entries[0].remove();
      }
    }
  </script>
</body>
</html>